---
- name: ensure packages are installed
  become: 'yes'
  ansible.builtin.apt:
    name:
      - 'git'
    state: 'present'
    update_cache: 'yes'

- name: clone the service-automation repo
  git:
    dest: '~/docker'
    clone: 'yes'
    update: 'yes'
    repo: "{{ github_repo_url }}"

- name: generate docker-compose.yml
  shell:
    chdir: '~/docker'
    cmd: 'find ./services/ -name "*.compose.yml" | xargs cat >> docker-compose.yml'

# todo: mount data dir from nfs
