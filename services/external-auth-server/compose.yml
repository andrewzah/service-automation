version: '3.7'

services:
  eas:
    image: travisghansen/external-auth-server:latest
    env_file:
      - "/mnt/data/services/external-auth-server/secret.env"
    environment:
      EAS_PORT: 8080
      EAS_CONFIG_TOKEN_STORES: '{}'
      EAS_LOG_LEVEL: "info"
      EAS_ALLOW_EVAL: 'true'
      EAS_STORE_OPTS: '{"store":"redis","host":"redis"}'
    ports:
      - "8080"
    restart: unless-stopped
    depends_on:
      - traefik
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.eas.rule=Host(`eas.zah.rocks`)"
      - "traefik.http.routers.eas.entrypoints=websecure"
      - "traefik.http.routers.eas.tls.certresolver=myresolver"

      - "traefik.http.middlewares.eas-default.forwardauth.trustForwardHeader=true"
      - "traefik.http.middlewares.eas-default.forwardauth.authResponseHeaders=X-Userinfo, X-Id-Token, X-Access-Token, Authorization"
      - "traefik.http.middlewares.eas-default.forwardauth.address=https://eas.zah.rocks/verify?config_token=%2BihV6%2F9CcXNCAOoc4grrmOmyxW0Xnbh0n8sY9qcgptvi1ct1bT857LxZBuctz8Qd%2BxSuhciOSvwxe66pmbl0uSIBZxrxo3ZfSaxIG0SBKLF9zhQhL49Gg8KxOKNBdIMdNYSTkD40F1Gjw6NnKr3%2FnmKOzlqiw0SpnbpE%2FOmLZeyRdSMPFd%2BlMiqO8HzFb0vdpSFtTqv7wa6FFFKQ5g5IldkYgYBwUB0%2B5ZDg%2FB0yA%2B16xGeIKVC8GeGxDhXhpX9j2TICREVLENlZZTxG9NTLUx72qt5eX03rb5DBzDp5Ko3YdOOpKrG7WMCY3NyReHq5ehAX8AfjHei%2Bkkmqn1ZLBIMKmoGOcuiuGRZ2dqCLUPEJy5s%2BwA5kv69NtqSceizW%2Bqx0yQH163I3Pc8neh9YzhkJPKMAZ6ZONMgD7sd2nDzU4zc9omUAg6qI9fQTfyNUqnq%2BV9uq0yjBMPzVt0rThSpwcCyProkDLpf%2BlhIQMD%2F1Enn1oagTahP4gg0k3XTgFNvjBNkwK1FE39dQyEYISnInR6%2BK6PhLX3XTIjszHF13BhEBtaWLZsT4Z9HQ20ybaZiVUzR%2B8BjGZJ1vTVyzCAvEtRdBxdT1YXONwqqzN9Rt9kWF6UM%2FnL4ZPqjwr3SdS5AHXSqDFx%2B7Y%2Bi2WM1%2FQr4DHZM%2BLIT%2BjhZ6g60XA9QhWQ%2Bvu4bGdvc0pBg7GNUXBMw%2BFaLiFTsSnVfZT0YOBze7vhOOME1afXamkTx8NODHRSsUoGl%2BVUuCHZfu0V5V96cG3UqLpTTCS879r5ak4DYwWUi4nEupA9AZOUW1lfLcV6jDPBX70njtxrNMrhpoHFvM3IrPRA87Gy3BQ0oWtavxuWWATCJmjJiRPWPVbPwlwSyamMjEhAsgVC0Q7MYRES12Xqfd%2Fry8YRQXVcW4YndERVvHM9xyabPWZwSIB2IzlwRhgtxBnDe1W%2F24fY%2BJ0KlTDsUOcZfLASqS7FmGcarQdNLlm7D3YF3w4gGbG%2BCCDzNBpkTLGxH06%2FjTuzCJzrNLE%2BAVPJUIeC7YxNtllUQ2hhmw99FCSckwWSbjpBgkqDauElwVXxop9fmJPM96gDyCamIez5WwEAa2Qv1qDvLPHfcsgdJMKxbUTL6OWH4Bj6Z%2F7ziRxooPwg1W6u1ZitZtYWptr6K7yjN8Gpuy6gPzZsTvIBoc65F8rIzT6HzwIsu4LjEGvFOqi4lQVBF0VMd6tdAk%2FRG7JTmkTxz2nMq1jSaGmAMxAo8Trw8ytwHD3PPb1lI5649rK%2Bj62KZy7c9Tmw4Ou%2FT7tqzdQUlJHnduMqbGPCxRCGEZQxnvIkK3mSSqnwvtRbcIAlsliYXak3e4hOsXRsgoliLEiWUKEDkwO5fU%2FyBiUQcNS7HjG3vuwr36i4Dmreox0FuhoMiIXNKJTtrJKRUo6%2BjARPUZzXjeBW7FGvVCj4YdysJe1sxDW%2F2or%2BVWsMAhbkxmu%2BYGt0OP%2BL5%2FTgqFVNFWMl7R0%2FnNmTpGPqm%2F0zumbgg%2FWUJZ5WrGqcHtQrGpWA%2B6dWWSidskzO%2Fn5i8RaFDq8NhpjY3olwZzkfBPtlT18qvA6xkAzV5A2lA3EHf6DHGK5ug3Mfij8YfTtPf6uIl7Be0SoMo0CbFymfOW9mwHNz2m%2BsWyIezIDc4epWN230VxUBG1Of1%2FstISpRtA3UITJnIFOVV3ty%2BgLQBVCr73DpLuJlkrCNxdrAf6eWTcH8c%2BaFbPHhVQ5czDvReOH4%2BAG07T0S7R%2FGM29xLoRSLiX3mmhlD5mcWcLJxerFxvUsNsgp8UZIpApfGBUJdVlql%2BRnKjVaNvjoYbKoT8YjgLzQ5tbJldowWIYKPVyj6YQHi3AF4F2EBzhXbaFYH38snOoHCrM8TncpDfEy%2BLnBwJeGkfGQc8qkaAuXgciLsaEXlUYy%2BxvYScSnpn4fVie9btqHFX1lWOGYx8%2BrhMSLLOv%2B5lIdT1qq2KY4qpH8PGFbV8icWVhx4IsNR%2FotkD0xe8JgjTJvleMh7VJV8aYPEyW6WTt0ameiHLck1JlP%2FrRNALfrpQ218%2FrliM0oJX9%2Fuybvn4fVL4OSMZ%2B%2FtG5KuBSa%2BPFObdmnAS0%2FPwcIiBhH371vMUWSlxvXqIq7kLfEK9Em%2Fq9IolTx%2FDyERd8LT1VbpdmDzYLOwtOhQmYYiy%2FX9sPl%2F1KyEXglG6sQoJflOVzG%2BGZCfrc4M3iZfh%2BowTXDuI64Y58fdNjaZhLAunu92co%2BSBnJIgVqC0UdTDHQhaD%2FXgRI0rh7z5iw6t7rT1B1pwygs%3D"
